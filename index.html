<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Документация</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@600&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- Меню слева -->
    <nav class="sidebar">
        <button onclick="showContent('intro')">Введение</button>
        <button onclick="showContent('architecture')">Архитектура</button>
        <button onclick="showContent('infrastructure')">Инфраструктурные решения</button>
        <button onclick="showContent('install')">Установка</button>
        <button onclick="showContent('algorithm')">Алгоритм</button>
        <button onclick="showContent('usage')">Использование</button>
        <button onclick="showContent('sbComputer')">Работа с одноплатным компьютером</button>
    </nav>

    <!-- Контент справа -->
    <main class="content">
        <div id="intro" class="content-section">
            <h1>Введение</h1>
            <p>Данный сервис представляет собой цифрового ассистента для врачей родильных отделений разработанный командой BroCode в рамках хакатона ЛЦТ 2025, направленного на
                автоматизацию мониторинга и анализа данных с фетальных мониторов. Основная цель — облегчить
                интерпретацию сложных медицинских сигналов и визуализировать динамику в наглядной форме, что позволяет
                медицинскому персоналу быстрее и точнее принимать решения в условиях повышенной нагрузки.</p>

            <p>В отличие от методов машинного обучения, в нашем решении применяются алгоритмы детерминированного анализа
                и распознавания ключевых паттернов в реальном времени. Система обрабатывает потоковые и архивированные
                данные, выявляя важные параметры, такие как децелерации, тахикардия, брадикардия и вариабельность
                сердечного ритма, а также строит краткосрочные прогнозы на основе текущих и исторических данных.</p>
        </div>

        <div id="architecture" class="content-section">
            <h1>Архитектура</h1>
            <img src="images/architecture.png" alt="arch" style="max-width: 100%; height: auto;">
            <h2>Проект состоит из трех основных компонентов:</h2>

            <h2>Сервис patient-history (Spring Boot)</h2>
            <a href="https://github.com/Dan9191/history" target="_blank">репозиторий</a>

            <ul>
                <li>Хранит данные пациенток, поступающие с медицинских приборов: показатели сократительной активность матки (uterus) и частоту
                    сердечных сокращений плода (bpm) во время родов.
                </li>
                <li>Взаимодействие с пользователем происходит через встроенный Thymeleaf.</li>
                <li>Сервис способен запускать поток данных через WebSocket, имитируя работу медицинских приборов в
                    реальном времени.
                </li>
            </ul>

            <h2>Сервис device (Spring Boot)</h2>
            <a href="https://github.com/Dan9191/device" target="_blank">репозиторий</a>
            <ul>
                <li>Читает данные с WebSocket сервиса patient-history.</li>
                <li>Обрабатывает и анализирует данные, выделяя необходимые параметры и формируя предсказания.</li>
                <li>Передает обработанные данные через свой WebSocket.</li>
            </ul>

            <h2>Фронтенд-приложение</h2>
            <a href="https://github.com/Dan9191/medical-frontend" target="_blank">репозиторий</a>
            <ul>
                <li>Периодически обращается к REST API сервиса device для получения данных о пациенте.</li>
                <li>Подписывается на WebSocket сервиса device для получения данных в реальном времени.</li>
                <li>Отображает графики и визуализации данных для удобства врачей.</li>
            </ul>

            <p>Взаимодействие между сервисами основано на REST и WebSocket, обеспечивая обработку и визуализацию данных
                в режиме реального времени. База данных хранит историю данных, что позволяет проводить анализ и
                мониторинг динамики состояний пациенток.</p>
            <p>Основная причина использование WebSocket для потоковой передачи данных: скорость и простота применения, в
                сравнении с различными брокерами сообщений.</p>

            <h2>Документация</h2>
            <a href="https://github.com/Dan9191/device-documentation" target="_blank">репозиторий</a>
            <p>Репозиторий, в котором описана документация к проекту.</p>
        </div>

        <div id="infrastructure" class="content-section">
            <h1>Инфраструктурные решения</h1>
            <img src="images/infra.png" alt="infra" style="max-width: 100%; height: auto;">
            <p>Проект развернут в Kubernetes-кластере из двух нод — одна мастер-нодa и одна воркер-нодa. Такой подход
                обеспечивает баланс между простотой поддержки и отказоустойчивостью, что важно для стабильной работы
                медицинского сервиса в режиме 24/7.</p>
            <h2>Управление кластером</h2>
            <ul>
                <li>Для управления кластером используется Argo CD</li>
                <li>Автоматизация процесса доставки кода (Continuous Delivery)</li>
                <li>Централизованный просмотр логов</li>
                <li>Визуальный контроль состояния сервисов в кластере</li>
            </ul>
            <h2>Безопасность</h2>
            <ul>
                <li>Для управления сертификатами применён cert-manager</li>
                <li>Автоматическое создание и обновление TLS-сертификатов</li>
                <li>Упрощение безопасности сетевого взаимодействия</li>
            </ul>
            <h2>CI/CD процесс</h2>
            <ul>
                <li>Исходный код хранится в GitHub</li>
                <li>При пуше в ветку master автоматически запускаются GitHub Actions</li>
                <li>Последовательное выполнение сборки, тестирования и деплоя приложений</li>
                <li>Создание контейнера при успешном билде и тестах</li>
                <li>Сохранение контейнера в GitHub Container Registry</li>
            </ul>
            <h2>Автоматизация деплоя</h2>
            <ul>
                <li>Инфраструктурный репозиторий синхронизирован с Argo CD</li>
                <li>Отслеживание тегов контейнеров</li>
                <li>Автоматический деплой нового контейнера в продакшен при обнаружении нового тега</li>
                <li>Обеспечение непрерывного обновления приложения</li>
            </ul>
        </div>

        <div id="install" class="content-section hidden">
            <h1>Установка</h1>
            <p>Шаги по установке...</p>
            <img src="images/install.png" alt="Install">
        </div>
        <div id="usage" class="content-section hidden">
            <h1>Использование</h1>

            <a href="https://disk.yandex.ru/i/CtWtu4bt2ft9WA" target="_blank">Пример работы</a>

            <p>Ссылка на сервис, работающий с хранением и передачей данных</p>
            <a href="https://patient-history.kumiko.pro/login" target="_blank">https://patient-history.kumiko.pro/login</a>
            <pre>
                <code>
                    PATIENT_LOGIN: "asdf123fhgf562"
                    PATIENT_PASSWORD: "ds31d124cxv"
                </code>
            </pre>

            <p>Ссылка на сервис, производящий вычисления и показывающий визуализацию (если в течении 10 секунд, после отправки данных, не появился график: просьба обновить страницу)</p>
            <a href="https://device.kumiko.pro/" target="_blank">https://device.kumiko.pro/</a>

            <p>После входа в сервис хранения и обработки данных доступны страницы с пациентами и диагнозами.</p>
            <p>Пациентов и диагнозы можно создавать, удалять и редактировать.</p>
            <p>При выборе пациентов стоит учитывать, что чем больше у него батчей, тем дольше происходит его открытие.
                Это связано с выгрузкой данных с приборов и отрисовкой.
                В будущем, в обычном использовании рекомендуется их поменять на картинки, а от выгрузки данных отказаться.
                Решение рисовать графики было принято на начальном этапе для визуализации данных(это было полезно).
                Так, при загрузке "тяжелого" пациента может потребоваться ждать 20-30 секунд.
            </p>

            <p>После того как пациент был выбран, доступны выгрузка данных батча в формате pdf, а так же отправка этих данных в потоковом режиме в WebSocket</p>
            <p>Сервис, анализирующий данные, постоянное слушает WebSocket отправителя. После поступления данных через 5-10 секунд они начинают отображаться в
                <a href="https://device.kumiko.pro/" target="_blank">https://device.kumiko.pro/</a></p>
            <p>Eсли в течение 10 секунд, после отправки данных, не появился график: просьба обновить страницу</p>

        </div>

        <div id="algorithm" class="content-section hidden">
            <h1>Алгоритм обработки данных для оценки рисков гипоксии плода</h1>

            <a href="https://github.com/Dan9191/device/blob/master/src/main/java/dan/competition/device/service/MessageHandlerService.java" target="_blank">Сервис, занимающийся потоковой обработкой данных</a>

            <p>Алгоритм работает в реальном времени: получает данные о пациенте и медицинские показатели, анализирует их по
                временным интервалам, проверяет риски осложнений и формирует предсказания. Для простоты фокус на
                основных этапах без технических деталей реализации.</p>

            <ul> <h2>Преимущества алгоритма:</h2>
                <li>Не требователен к ресурсам</li>
                <li>Легкий в понимании</li>
                <li>Доступна тонкая настройка для каждого осложнения/диагноза/заболевания</li>
                <li>Алгоритм легко расширяется с помощью добавления новых метрик</li>
                <li>Данные об осложнениях/диагнозах/заболеваниях не привязаны жестко к коду, т.е. для изменения "влияния" достаточно поменять только метаданные модели</li>
            </ul>

            <ul> <h2>Минусы:</h2>
                <li>Требуется провести аналитическую работу по влиянию каждого осложнения/диагноза/заболевания как по отдельности, так и вместе</li>
            </ul>

            <p>Алгоритм разделен на 4 части, как указано в запросе.</p>

            <h2>1. Подготовительная часть</h2>
            <p>На этом этапе обрабатываются начальные данные о пациенте, полученные через WebSocket (<code>PatientDataWebSocket</code>).
                Цель — установить персонализированные нормы и базовый риск рождения ребенка с гипоксией на основе
                диагнозов пациента. Делается это с помощью формул Groovy, которые хранятся в поле "impact" для каждого диагноза</p>


            <h2>2. Сбор данных в пачки для вычисления средних показателей</h2>
            <p>Медицинские данные (<code>MedicalDataWebSocket</code>) поступают в реальном времени: время в секундах
                (<code>timeSec</code>), сократительная активность матки (<code>uterus</code>) и частота сердечных
                сокращений плода (<code>bpm</code>).
                Во время поступления данных они отправлятся на фронтенд для отрисовки графика, параллельно собираются показатели,
                для поиска среднего значения за отрезок времени. Величину временного интервала можно задавать отдельно.</p>



            <h2>3. Проверка осложнений в конце каждого промежутка</h2>
            <p>После закрытия окна запускается анализ рисков на основе списка осложнений (<code>Complications</code>).
                Каждое осложнение имеет поле <code>condition</code> — Groovy-скрипт, который проверяет наличие риска по
                текущим средним значениям.</p>
            <ul>
                <li><strong>Шаги обработки</strong>:
                    <ol>
                        <li>Перебор осложнений: Для каждого объекта <code>Complications</code> выполняется скрипт в
                            <code>condition</code>.
                            <ul>
                                <li>Скрипт возвращает boolean: true (риск есть) или false (риска нет).</li>
                                <li>Скрипт использует переменные из <code>avgVariables</code> (например,
                                    <code>avgBpm</code>, <code>bpmMin</code>, <code>bpmMax</code> и т.д.).
                                </li>
                                <li>Пример :
                                    <pre>
                                        <code>
                                            new Complications(3L,
                                            "Брадикардия",
                                            "Замедление частоты сердечных сокращений",
                                            "avgBpm < bpmMin"
                                            )
                                        </code>
                                    </pre>
                                    <ul>
                                        <li>Если <code>avgBpm</code> ниже нормы (<code>bpmMin</code>), скрипт вернет
                                            true.
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>Обновление счетчиков рисков: Для каждого осложнения ведется отдельный счетчик (в мапе <code>riskCounters</code>,
                            ключ — ID осложнения).
                            <ul>
                                <li>Если риск = true: счетчик +1 (риск накапливается при повторении).</li>
                                <li>Если риск = false: счетчик -2 (риск быстро снижается при нормализации), но не ниже
                                    0.
                                </li>
                            </ul>
                        </li>
                        <li>Влияние на общий риск: Каждый активный счетчик (>0) прибавляет к динамическому риску
                            гипоксии. Суммарный счетчик всех осложнений (total) умножается на 5% для динамической части
                            риска.
                        </li>
                    </ol>
                </li>
                <li><strong>Результат</strong>: Обновлены счетчики для каждого осложнения. Это моделирует "память"
                    системы: повторяющиеся риски усиливают общий шанс гипоксии, а исчезающие — снижают его.
                </li>
            </ul>

            <h2>4. Формирование предсказания с перечислением осложнений и шансом гипоксии</h2>
            <p>После анализа создается объект <code>Prediction</code> и отправляется по WebSocket (<code>/topic/predictions</code>).
            </p>
            <ul>
                <li><strong>Шаги обработки</strong>:
                    <ol>
                        <li>Сбор активных осложнений: Список имен осложнений, где счетчик > 0.</li>
                        <li>Формирование сообщения (<code>message</code>):
                            <ul>
                                <li>Если активных нет: "Прогноз положительный".</li>
                                <li>Если есть: "Активные осложнения: [имя1, имя2, ...]".</li>
                            </ul>
                        </li>
                        <li>Определение уровня серьезности (<code>severity</code>):
                            <ul>
                                <li>Суммарный счетчик (total) всех осложнений:
                                    <ul>
                                        <li>>6: "negative" (высокий риск).</li>
                                        <li>=0: "positive" (низкий риск).</li>
                                        <li>Иначе: "normal" (средний риск).</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>Расчет шанса гипоксии (<code>riskComplication</code>):
                            <ul>
                                <li>Базовый риск (из части 1, <code>riskComplications</code>).</li>
                                <li>Динамический риск: total * 5% (ограничено до 100%).</li>
                                <li>Итоговый шанс: базовый + динамический (ограничено 0–100%).</li>
                            </ul>
                        </li>
                        <li>Добавление времени: <code>timestamp</code> = текущее время.</li>
                    </ol>
                </li>
                <li><strong>Результат</strong>: Готовое предсказание с текстом, уровнем серьезности и шансом родов с
                    гипоксией. Это позволяет пользователю (врачу) быстро оценить ситуацию и принять меры.
                </li>
            </ul>


            <h2>Разбор осложнений</h2>

            <h3>1. Децелерация</h3>
            <div class="description">
                <p><strong>Описание:</strong> Эпизод снижения частоты сердечных сокращений (ЧСС) плода на 15 ударов в минуту и более с продолжительностью не менее 15 секунд.</p>
            </div>
            <div class="clinical">
                <p><strong>Клиническое значение:</strong> Может указывать на гипоксию плода, компрессию пуповины или плацентарную недостаточность.</p>
            </div>
            <div class="code">
                <p><strong>Формула (Groovy):</strong></p>
                <pre>(prevAvgBpm - avgBpm) >= 15 && avgBpm < bpmMin</pre>
            </div>
            <p><strong>Логика:</strong> Проверяется, снизилась ли ЧСС плода относительно предыдущего периода минимум на 15 уд/мин и опустилась ниже нижней границы нормы (bpmMin).</p>

            <h3>2. Тахикардия</h3>
            <div class="description">
                <p><strong>Описание:</strong> Увеличение частоты сердечных сокращений плода выше физиологической нормы.</p>
            </div>
            <div class="clinical">
                <p><strong>Клиническое значение:</strong> Может быть следствием гипоксии, лихорадки матери, инфекции или реакции на лекарственные препараты.</p>
            </div>
            <div class="code">
                <p><strong>Формула (Groovy):</strong></p>
                <pre>avgBpm > bpmMax</pre>
            </div>
            <p><strong>Логика:</strong> Если средняя ЧСС превышает верхнюю допустимую границу (bpmMax), фиксируется риск тахикардии.</p>

            <h3>3. Брадикардия</h3>
            <div class="description">
                <p><strong>Описание:</strong> Замедление частоты сердечных сокращений плода ниже физиологической нормы.</p>
            </div>
            <div class="clinical">
                <p><strong>Клиническое значение:</strong> Может указывать на выраженную гипоксию, сдавление пуповины или тяжелую брадикардию вследствие медикаментов.</p>
            </div>
            <div class="code">
                <p><strong>Формула (Groovy):</strong></p>
                <pre>avgBpm < bpmMin</pre>
            </div>
            <p><strong>Логика:</strong> Если средняя ЧСС ниже нижнего допустимого порога (bpmMin), фиксируется риск брадикардии.</p>

            <h3>4. Вариабельность сердечного ритма</h3>
            <div class="description">
                <p><strong>Описание:</strong> Колебания интервалов между ударами сердца, отражающие способность сердечно-сосудистой системы плода адаптироваться к изменениям.</p>
            </div>
            <div class="clinical">
                <p><strong>Клиническое значение:</strong></p>
                <ul>
                    <li>Низкая вариабельность (&lt;5 уд/мин) — может быть признаком угнетения ЦНС плода, гипоксии или воздействия седативных препаратов.</li>
                    <li>Чрезмерная вариабельность (&gt;25 уд/мин) — признак возможных аритмий или острой гипоксии.</li>
                </ul>
            </div>
            <div class="code">
                <p><strong>Формула (Groovy):</strong></p>
                <pre>Math.abs(avgBpm - prevAvgBpm) < 5 || Math.abs(avgBpm - prevAvgBpm) > 25</pre>
            </div>
            <p><strong>Логика:</strong> Если разница между текущей и предыдущей средней ЧСС слишком мала (&lt;5) или слишком велика (&gt;25), считается, что вариабельность патологическая.</p>

        </div>

        <div id="sbComputer" class="content-section hidden">
            <h1>Работа с одноплатным компьютером</h1>

            <a href="https://disk.yandex.ru/i/x-EDMgi0gv6IQw" target="_blank">Пример работы</a>

            <img src="images/pi3.png" alt="pi3" style="max-width: 100%; height: auto;">

            <p>Для работы с одноплатным компьютером Orange Pi Zero 3 был установлен в качестве ОС Armbian_25.5.1</p>

            <p>Инструкция:</p>

            <pre><code>
                # Базовые пакеты
                sudo apt update && sudo apt upgrade -y
                sudo apt install -y git curl wget unzip apt-transport-https ca-certificates gnupg lsb-release
            </code></pre>

            <pre><code>
                # Установка JDK 21
                sudo apt install -y openjdk-21-jdk
                java -version
            </code></pre>


            <pre><code>
                # Установка Node.js
                curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
                sudo apt install -y nodejs
                node -v
                npm -v
            </code></pre>

            <p>В нашем случае используется кубернетес для подключения к источнику потоковых данных</p>
            <pre><code>
                # Установка  kubectl
                wget https://dl.k8s.io/release/v1.31.1/bin/linux/arm64/kubectl -O kubectl
                chmod +x kubectl
                sudo mv kubectl /usr/local/bin/
                kubectl version --client
            </code></pre>

            <p>Далее настраиваем kube config (файл конфигурации не дам)</p>

            <pre><code>
                # Прокидываем наружу порт для чтения данных
                kubectl port-forward -n patient-history pod/patient-history-dep-788599c4c6-bcvg9 8097:8097
            </code></pre>

            <p>Создаем папки для проектов и выгружаем с репозитория</p>
            <pre><code>
                # Перейдём в рабочую папку
                mkdir -p ~/projects
                cd ~/projects

                # Клонируем Spring Boot
                git clone https://github.com/Dan9191/device.git

                # Клонируем React фронт
                git clone https://github.com/Dan9191/medical-frontend.git
            </code></pre>

            <p>В соответствующих папках выполняем команды запуска</p>
            <pre><code>
                # бэкенд
                chmod +x gradlew
                ./gradlew bootRun

                #React
                npm start
            </code></pre>
        </div>
    </main>
</div>
<script src="script.js"></script>
</body>
</html>